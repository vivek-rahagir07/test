<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta 
        name="viewport" 
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>BMU Campus Radio</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Import Map for React, Firebase, Icons -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.300.0",
        "firebase/app": "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js",
        "firebase/auth": "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js",
        "firebase/analytics": "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js"
      }
    }
    </script>

    <style>
        /* Scrollbar hide */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Generic animations */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .animate-float {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes slideUpFade {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide-up {
            animation: slideUpFade 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        @keyframes equalizer {
            0% { height: 3px; }
            50% { height: 15px; }
            100% { height: 3px; }
        }
        .equalizer-bar {
            animation: equalizer 1s infinite ease-in-out;
        }
        .equalizer-bar:nth-child(2) { animation-delay: 0.2s; }
        .equalizer-bar:nth-child(3) { animation-delay: 0.4s; }
        .equalizer-bar:nth-child(4) { animation-delay: 0.1s; }

        .fade-in-up {
            animation: fadeInUp 0.5s ease-out forwards;
            opacity: 0;
            transform: translateY(20px);
        }
        @keyframes fadeInUp {
            to { opacity: 1; transform: translateY(0); }
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }

        .modal-enter {
            animation: modalSlideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
        @keyframes modalSlideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        @keyframes scaleIn {
            from { transform: scale(0.97); opacity: 0; }
            to   { transform: scale(1);    opacity: 1; }
        }
    </style>
</head>
<body class="bg-slate-900">
    <div id="root"></div>

    <!-- MAIN APP SCRIPT (Parts 2, 3, 4 continue inside this tag) -->
    <script type="text/babel" data-type="module">
      /***********************
       * IMPORTS
       ***********************/
      import React, { useState, useEffect, useRef } from "react";
      import { createRoot } from "react-dom/client";
      import {
        Play, Pause, Mic, Music, Video, User, Plus,
        Heart, MessageCircle, Radio, Ghost, LogOut,
        Headphones, X, Share2, Volume2, Trash2, MoreHorizontal,
        Flame, Zap, Info, RadioReceiver, Upload, Link as LinkIcon, FileAudio,
        Maximize2, ExternalLink, Calendar, Send, AlertCircle, Settings, ShieldAlert,
        UserCircle, ListMusic, PlusCircle, Briefcase, GraduationCap, ChevronRight, Lock, Mail, Camera
      } from "lucide-react";

      import { initializeApp } from "firebase/app";
      import { getAnalytics, isSupported } from "firebase/analytics";
      import {
        getAuth,
        signInWithEmailAndPassword,
        createUserWithEmailAndPassword,
        onAuthStateChanged,
        updateProfile,
        signOut
      } from "firebase/auth";
      import {
        getFirestore,
        collection,
        addDoc,
        onSnapshot,
        serverTimestamp,
        query,
        doc,
        updateDoc,
        deleteDoc,
        increment
      } from "firebase/firestore";

      /***********************
       * FIREBASE CONFIG + INIT
       ***********************/
      const firebaseConfig = {
        apiKey: "AIzaSyA5qQbhXqej2Ill5jtHWgvsBpk9BsR3a7c",
        authDomain: "bmuradio.firebaseapp.com",
        databaseURL: "https://bmuradio-default-rtdb.firebaseio.com",
        projectId: "bmuradio",
        storageBucket: "bmuradio.firebasestorage.app",
        messagingSenderId: "230545998240",
        appId: "1:230545998240:web:c1832311a2f066cb7b24c5",
        measurementId: "G-51N1VLP1DY"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      // Analytics (safe)
      let analytics;
      isSupported().then((yes) => {
        if (yes) analytics = getAnalytics(app);
      });

      /***********************
       * SHARED CONSTANTS & HELPERS
       ***********************/
      const CATEGORIES = [
        { id: "podcast", label: "Podcasts", icon: Mic, color: "from-orange-400 to-orange-600", shadow: "shadow-orange-200" },
        { id: "music", label: "Music", icon: Music, color: "from-purple-400 to-purple-600", shadow: "shadow-purple-200" },
        { id: "skills", label: "Skills", icon: Video, color: "from-blue-400 to-blue-600", shadow: "shadow-blue-200" },
        { id: "buzz", label: "Campus Buzz", icon: Ghost, color: "from-pink-500 to-rose-600", shadow: "shadow-pink-200" }
      ];

      const SAMPLE_TRACKS = [
        { title: "BMU Morning Lofi", artist: "Campus Vibes", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" },
        { title: "Student Council Update", artist: "Pres. Office", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" },
        { title: "Exam Motivation", artist: "Study Group", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3" }
      ];

      const getEmbedUrl = (url) => {
        if (!url) return null;
        try {
          const ytMatch = url.match(/(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|shorts\/|live\/|feature\=player_embedded&v=))([\w-]{11})/);
          if (ytMatch && ytMatch[1]) {
            return `https://www.youtube.com/embed/${ytMatch[1]}?autoplay=1&rel=0`;
          }
          const vimeoMatch = url.match(/vimeo\.com\/(\d+)/);
          if (vimeoMatch && vimeoMatch[1]) {
            return `https://player.vimeo.com/video/${vimeoMatch[1]}?autoplay=1`;
          }
          return null;
        } catch (e) {
          console.error("Error parsing video URL", e);
          return null;
        }
      };

      const isVideoFile = (url) => {
        return (
          url &&
          (url.match(/\.(mp4|webm|ogg|mov|m4v)(\?.*)?$/i) ||
            url.startsWith("blob:"))
        );
      };

      const Styles = () => (
        <style>{`
          @keyframes equalizer {
            0% { height: 3px; }
            50% { height: 15px; }
            100% { height: 3px; }
          }
          .equalizer-bar {
            animation: equalizer 1s infinite ease-in-out;
          }
          .equalizer-bar:nth-child(2) { animation-delay: 0.2s; }
          .equalizer-bar:nth-child(3) { animation-delay: 0.4s; }
          .equalizer-bar:nth-child(4) { animation-delay: 0.1s; }

          .fade-in-up {
            animation: fadeInUp 0.5s ease-out forwards;
            opacity: 0;
            transform: translateY(20px);
          }
          @keyframes fadeInUp {
            to { opacity: 1; transform: translateY(0); }
          }

          .glass-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
          }

          .modal-enter {
            animation: modalSlideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
          }
          @keyframes modalSlideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
          }

          @keyframes scaleIn {
            from { transform: scale(0.97); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
          }
        `}</style>
      );

      /***********************
       * PART 2 STARTS AFTER THIS COMMENT
       * (Components: LoadingScreen, LoginSelection, etc.)
       ***********************/
/**************************************
 *  LOADING SCREEN
 **************************************/
const LoadingScreen = () => (
  <div className="flex items-center justify-center h-screen bg-slate-900 text-white">
    <div className="text-center animate-slide-up">
      <RadioReceiver size={60} className="mx-auto text-red-500 animate-pulse" />
      <h1 className="text-2xl font-bold mt-4">BMU Campus Radio</h1>
      <p className="text-slate-300 text-sm mt-2">Tuning frequencies...</p>
    </div>
  </div>
);

/**************************************
 *  LOGIN SCREEN
 **************************************/
const LoginSelection = ({ setUser }) => {
  const [email, setEmail] = useState("");
  const [pass, setPass] = useState("");
  const [creating, setCreating] = useState(false);

  const login = async () => {
    try {
      await signInWithEmailAndPassword(auth, email, pass);
    } catch (err) {
      alert("Login failed: " + err.message);
    }
  };

  const register = async () => {
    try {
      await createUserWithEmailAndPassword(auth, email, pass);
    } catch (err) {
      alert("Signup failed: " + err.message);
    }
  };

  return (
    <div className="flex items-center justify-center h-screen bg-slate-900 text-white px-6">
      <div className="glass-panel rounded-3xl p-8 w-full max-w-md shadow-xl animate-slide-up">

        <div className="flex flex-col items-center">
          <RadioReceiver size={50} className="text-red-500 animate-pulse" />
          <h1 className="text-3xl font-extrabold mt-3">BMU Campus Radio</h1>
          <p className="text-slate-600 text-sm">Broadcast your voice to the campus</p>
        </div>

        <div className="mt-8 space-y-4">
          <input
            type="email"
            placeholder="BMU Email"
            className="w-full px-4 py-3 rounded-xl bg-slate-100 text-slate-800"
            onChange={(e) => setEmail(e.target.value)}
          />
          <input
            type="password"
            placeholder="Password"
            className="w-full px-4 py-3 rounded-xl bg-slate-100 text-slate-800"
            onChange={(e) => setPass(e.target.value)}
          />
        </div>

        <button
          onClick={login}
          className="w-full mt-6 bg-red-600 hover:bg-red-700 transition text-white py-3 rounded-2xl font-bold"
        >
          Login
        </button>

        <button
          onClick={register}
          className="w-full mt-3 bg-white text-slate-900 py-3 rounded-2xl font-bold border"
        >
          Create New Account
        </button>
      </div>
    </div>
  );
};

/**************************************
 *  HEADER NAVIGATION BAR
 **************************************/
const HeaderBar = ({ user, setShowCreate, setShowProfile }) => (
  <div className="sticky top-0 z-40 bg-slate-900/80 backdrop-blur-xl border-b border-slate-700 px-5 py-4 flex items-center justify-between shadow">

    <div className="flex items-center gap-3">
      <RadioReceiver size={26} className="text-red-500" />
      <h1 className="text-xl font-bold text-white tracking-tight">BMU Radio</h1>
    </div>

    <div className="flex items-center gap-4">
      <button
        onClick={() => setShowCreate(true)}
        className="bg-red-600 hover:bg-red-700 transition text-white px-4 py-2 rounded-xl font-bold flex items-center gap-2"
      >
        <Plus size={18} /> New Broadcast
      </button>

      <img
        src={user?.photoURL || "https://i.imgur.com/IL6RzjT.png"}
        className="w-10 h-10 rounded-full border border-slate-600 cursor-pointer"
        onClick={() => setShowProfile(true)}
      />
    </div>
  </div>
);

/**************************************
 *  PROFILE MENU
 **************************************/
const ProfilePanel = ({ user, onClose }) => {
  const logout = async () => {
    await signOut(auth);
  };

  return (
    <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex justify-end items-start p-6">

      <div className="bg-white rounded-3xl w-80 p-6 shadow-2xl animate-slide-up">

        <div className="flex items-center gap-4 mb-6">
          <img
            src={user?.photoURL || "https://i.imgur.com/IL6RzjT.png"}
            className="w-14 h-14 rounded-full border"
          />
          <div>
            <p className="font-bold text-lg">{user?.displayName || "User"}</p>
            <p className="text-slate-600 text-sm">{user?.email}</p>
          </div>
        </div>

        <button
          className="w-full py-3 bg-slate-900 text-white rounded-xl font-bold flex items-center justify-center gap-2"
          onClick={logout}
        >
          <LogOut size={18} /> Logout
        </button>

        <button
          onClick={onClose}
          className="w-full mt-3 py-3 bg-slate-200 rounded-xl font-bold"
        >
          Close
        </button>

      </div>
    </div>
  );
};

/**************************************
 *  AUDIO PLAYER
 **************************************/
const AudioPlayer = ({ currentTrack, playing, setPlaying }) => {
  if (!currentTrack) return null;

  return (
    <div className="fixed bottom-0 left-0 right-0 z-50 flex items-center justify-between bg-white/70 backdrop-blur-xl border-t px-5 py-3">

      <div>
        <p className="font-bold text-slate-800 text-sm">{currentTrack.title}</p>
        <p className="text-slate-500 text-xs">{currentTrack.artist}</p>
      </div>

      <button
        onClick={() => setPlaying(!playing)}
        className="bg-red-600 text-white rounded-full p-3 shadow"
      >
        {playing ? <Pause /> : <Play />}
      </button>
    </div>
  );
};

/**************************************
 *  POST CARD COMPONENT
 **************************************/
const PostCard = ({ post, onPlay }) => {
  const LiveIcon = () => (
    <div className="flex items-center gap-1.5">
      <span className="w-2 h-2 bg-red-500 rounded-full animate-pulse"></span>
      <span className="text-red-600 font-bold text-xs">LIVE</span>
    </div>
  );

  const RecordedIcon = () => (
    <div className="flex items-center gap-1.5">
      <FileAudio size={12} className="text-slate-500" />
      <span className="text-slate-600 font-semibold text-xs">Recording</span>
    </div>
  );

  return (
    <div className="bg-white/90 backdrop-blur-xl rounded-2xl p-5 border shadow-md animate-slide-up">
      {/* Top â€” Broadcasting type */}
      <div className="flex justify-between items-center mb-4">
        {post.broadcastType === "live" ? <LiveIcon /> : <RecordedIcon />}
        <span className="text-[10px] uppercase text-slate-500">{post.category}</span>
      </div>

      {/* Title */}
      <h2 className="font-bold text-slate-900 text-lg">{post.title}</h2>

      {/* Author */}
      {!post.isAnonymous && (
        <div className="flex items-center gap-2 mt-2">
          <img
            src={post.authorPhoto || "https://i.imgur.com/IL6RzjT.png"}
            className="w-8 h-8 rounded-full"
          />
          <p className="text-slate-700 text-sm">{post.authorName}</p>
        </div>
      )}

      {/* Description */}
      <p className="text-slate-600 text-sm mt-3">{post.description}</p>

      {/* Media preview */}
      <button
        className="mt-4 w-full bg-slate-900 text-white py-2.5 rounded-xl font-semibold flex items-center justify-center gap-2"
        onClick={() => onPlay(post)}
      >
        <Play size={16} /> {post.broadcastType === "live" ? "Open Stream" : "Play Recording"}
      </button>
    </div>
  );
};

/**************************************
 *  FEED SECTION
 **************************************/
const Feed = ({ posts, onPlay }) => {
  const livePosts = posts.filter((p) => p.broadcastType === "live");
  const recordings = posts.filter((p) => p.broadcastType === "recorded");

  return (
    <div className="px-5 py-6 space-y-10">
      
      {/* LIVE NOW */}
      {livePosts.length > 0 && (
        <div>
          <h2 className="text-xl font-bold text-white mb-4">ðŸ”´ Live Now</h2>
          <div className="space-y-5">
            {livePosts.map((p) => (
              <PostCard key={p.id} post={p} onPlay={onPlay} />
            ))}
          </div>
        </div>
      )}

      {/* RECORDINGS */}
      <div>
        <h2 className="text-xl font-bold text-white mb-4">ðŸŽ§ Recordings</h2>
        <div className="space-y-5">
          {recordings.map((p) => (
            <PostCard key={p.id} post={p} onPlay={onPlay} />
          ))}
        </div>
      </div>

    </div>
  );
};

/**************************************
 *  NEXT â†’ PART 3 (CreatePostModal)
 **************************************/
/**************************************
 *  CREATE POST MODAL â€” POLISHED UI
 **************************************/
const CreatePostModal = ({ onClose, user }) => {
  const [title, setTitle] = useState("");
  const [description, setDescription] = useState("");
  const [category, setCategory] = useState("podcast");

  const [broadcastType, setBroadcastType] = useState("recorded"); // "live" | "recorded"
  const [mediaType, setMediaType] = useState("upload");           // For recordings
  const [mediaUrl, setMediaUrl] = useState("");
  const [mediaFile, setMediaFile] = useState(null);

  const [isAnonymous, setIsAnonymous] = useState(false);
  const [loading, setLoading] = useState(false);

  const isLive = broadcastType === "live";
  const isRecorded = broadcastType === "recorded";

  /**************************************
   * FORM SUBMIT
   **************************************/
  const handleSubmit = async (e) => {
    e.preventDefault();

    if (!title.trim() || !description.trim()) {
      alert("Please fill title and description properly.");
      return;
    }

    if (isLive && !mediaUrl.trim()) {
      alert("Please add a YouTube Live / Meet link for Go Live mode.");
      return;
    }

    if (isRecorded) {
      if (mediaType === "upload" && !mediaFile) {
        alert("Please upload an audio/video file.");
        return;
      }
      if (mediaType === "link" && !mediaUrl.trim()) {
        alert("Please paste a valid media link.");
        return;
      }
    }

    setLoading(true);
    try {
      let finalMediaUrl = mediaUrl;

      if (isRecorded && mediaType === "upload" && mediaFile) {
        // Local URL (temporary preview)
        finalMediaUrl = URL.createObjectURL(mediaFile);
      }

      await addDoc(collection(db, "bmu_radio_posts"), {
        title,
        description,
        category,
        broadcastType,
        mediaUrl: finalMediaUrl || null,
        isAnonymous,
        authorId: user.uid,
        authorName: user.displayName || "Student",
        authorPhoto: user.photoURL || null,
        createdAt: serverTimestamp(),
        likes: 0
      });

      onClose();
    } catch (err) {
      alert("Error posting: " + err.message);
    }

    setLoading(false);
  };

  /**************************************
   *  UI
   **************************************/
  return (
    <div className="fixed inset-0 z-[70] flex items-center justify-center p-5">

      {/* BACKDROP */}
      <div 
        className="absolute inset-0 bg-black/60 backdrop-blur-sm" 
        onClick={onClose}
      ></div>

      {/* MODAL */}
      <div className="relative z-10 w-full max-w-4xl bg-white/80 rounded-3xl shadow-2xl border border-slate-300/40 backdrop-blur-xl animate-[scaleIn_0.25s_ease-out] overflow-hidden">

        {/* HEADER */}
        <div className="bg-gradient-to-r from-slate-900 via-slate-800 to-red-700 px-6 py-4 flex justify-between items-center">
          <div className="flex items-center gap-3">
            <div className="w-10 h-10 bg-white/10 rounded-2xl flex items-center justify-center text-red-300">
              <RadioReceiver size={20} />
            </div>
            <div>
              <p className="text-[11px] uppercase text-slate-300 tracking-widest font-semibold">
                Create Broadcast
              </p>
              <h2 className="text-white text-xl font-black">BMU Studio Panel</h2>
            </div>
          </div>

          <button 
            onClick={onClose}
            className="p-2 rounded-full bg-white/10 hover:bg-white/20 text-white"
          >
            <X size={22} />
          </button>
        </div>

        {/* BODY */}
        <form 
          onSubmit={handleSubmit}
          className="p-6 grid grid-cols-1 lg:grid-cols-2 gap-6"
        >

          {/*********************
           * LEFT COLUMN
           *********************/}
          <div className="space-y-5">

            {/* Mobile Mode Switch */}
            <div className="lg:hidden flex bg-slate-200 p-1 rounded-xl">
              <button
                type="button"
                onClick={() => setBroadcastType("live")}
                className={`flex-1 py-2 rounded-lg text-xs font-bold ${
                  isLive ? "bg-red-600 text-white" : "text-slate-600"
                }`}
              >
                ðŸ”´ Go Live
              </button>
              <button
                type="button"
                onClick={() => setBroadcastType("recorded")}
                className={`flex-1 py-2 rounded-lg text-xs font-bold ${
                  isRecorded ? "bg-slate-900 text-white" : "text-slate-600"
                }`}
              >
                ðŸŽ§ Recording
              </button>
            </div>

            {/* Title */}
            <div>
              <label className="text-[11px] uppercase tracking-widest text-slate-600 font-bold">
                Broadcast Title
              </label>
              <input
                className="w-full px-4 py-3 rounded-2xl bg-slate-100 border mt-1"
                placeholder="e.g., BMU Talkshow â€“ Episode 4"
                value={title}
                onChange={(e) => setTitle(e.target.value)}
              />
            </div>

            {/* Category */}
            <div>
              <label className="text-[11px] uppercase tracking-widest text-slate-600 font-bold">
                Category
              </label>
              <select
                value={category}
                onChange={(e) => setCategory(e.target.value)}
                className="w-full px-4 py-3 rounded-2xl bg-slate-100 border mt-1"
              >
                {CATEGORIES.map((c) => (
                  <option key={c.id} value={c.id}>
                    {c.label}
                  </option>
                ))}
              </select>
            </div>

            {/* Anonymous */}
            <div
              className="flex justify-between items-center px-4 py-3 rounded-2xl bg-slate-100 border cursor-pointer"
              onClick={() => setIsAnonymous(!isAnonymous)}
            >
              <div className="flex items-center gap-2">
                <Ghost className={isAnonymous ? "text-black" : "text-slate-500"} />
                <span className="font-semibold">
                  {isAnonymous ? "Anonymous (ON)" : "Show My Profile"}
                </span>
              </div>
              <div
                className={`w-10 h-5 rounded-full ${
                  isAnonymous ? "bg-black" : "bg-slate-500"
                } relative`}
              >
                <div
                  className={`absolute bg-white w-4 h-4 rounded-full top-[2px] transition-all ${
                    isAnonymous ? "left-5" : "left-1"
                  }`}
                ></div>
              </div>
            </div>

            {/* Description */}
            <div>
              <label className="text-[11px] uppercase tracking-widest text-slate-600 font-bold">
                Description
              </label>
              <textarea
                className="w-full h-28 px-4 py-3 rounded-2xl bg-slate-100 border mt-1 resize-none"
                placeholder="Describe your podcast / live session..."
                value={description}
                onChange={(e) => setDescription(e.target.value)}
              ></textarea>
            </div>
          </div>

          {/*********************
           * RIGHT COLUMN
           * (LIVE + RECORDED SECTIONS)
           *********************/}
          <div className="space-y-6">

            {/* GO LIVE SECTION */}
            <div
              className={`p-5 rounded-2xl border cursor-pointer transition relative ${
                isLive
                  ? "border-red-500 bg-red-50 shadow-md"
                  : "border-slate-300 bg-white"
              }`}
              onClick={() => setBroadcastType("live")}
            >
              <div className="flex gap-3">
                <div className="w-10 h-10 rounded-xl bg-red-600 text-white flex items-center justify-center">
                  <RadioReceiver size={18} />
                </div>
                <div>
                  <h3 className="font-bold text-slate-900">Go Live</h3>
                  <p className="text-xs text-slate-500">
                    Use this mode to broadcast a real-time live stream.
                  </p>
                </div>
              </div>

              {isLive ? (
                <div className="mt-4">
                  <label className="text-[10px] uppercase tracking-widest text-slate-600 font-bold">
                    Live Stream Link
                  </label>
                  <input
                    type="url"
                    placeholder="YouTube Live / Meet link..."
                    className="mt-1 w-full px-4 py-2 rounded-xl bg-white border border-red-300"
                    value={mediaUrl}
                    onChange={(e) => setMediaUrl(e.target.value)}
                  />
                </div>
              ) : (
                <p className="text-[10px] mt-2 text-slate-500">
                  Click to switch to Go Live mode.
                </p>
              )}
            </div>

            {/* RECORDING SECTION */}
            <div
              className={`p-5 rounded-2xl border cursor-pointer transition ${
                isRecorded
                  ? "bg-slate-900 text-white border-slate-700 shadow-lg"
                  : "bg-white border-slate-300"
              }`}
              onClick={() => setBroadcastType("recorded")}
            >
              <div className="flex gap-3">
                <div
                  className={`w-10 h-10 rounded-xl flex items-center justify-center ${
                    isRecorded ? "bg-red-600" : "bg-slate-900 text-white"
                  }`}
                >
                  <FileAudio size={18} />
                </div>

                <div>
                  <h3 className={`font-bold ${isRecorded ? "text-white" : "text-slate-900"}`}>
                    Recording
                  </h3>
                  <p className={`text-xs ${isRecorded ? "text-slate-300" : "text-slate-500"}`}>
                    Upload audio/video or paste a media link.
                  </p>
                </div>
              </div>

              {isRecorded && (
                <div className="mt-4 space-y-3">

                  {/* Upload / Link toggle */}
                  <div className="flex bg-black/20 rounded-xl overflow-hidden border border-slate-700">
                    <button
                      type="button"
                      onClick={(e) => {
                        e.stopPropagation();
                        setMediaType("upload");
                      }}
                      className={`flex-1 py-2 text-sm ${
                        mediaType === "upload"
                          ? "bg-white text-black font-bold"
                          : "text-slate-300"
                      }`}
                    >Upload File</button>

                    <button
                      type="button"
                      onClick={(e) => {
                        e.stopPropagation();
                        setMediaType("link");
                      }}
                      className={`flex-1 py-2 text-sm border-l border-slate-600 ${
                        mediaType === "link"
                          ? "bg-white text-black font-bold"
                          : "text-slate-300"
                      }`}
                    >Use Link</button>
                  </div>

                  {/* File Upload */}
                  {mediaType === "upload" ? (
                    <div className="relative border-2 border-dashed border-slate-600 rounded-xl p-6 text-center">
                      <input
                        type="file"
                        accept="audio/*,video/*"
                        className="absolute inset-0 opacity-0 cursor-pointer"
                        onChange={(e) => setMediaFile(e.target.files[0])}
                      />
                      {mediaFile ? (
                        <>
                          <FileAudio size={28} className="mx-auto text-red-300" />
                          <p className="text-sm mt-2 font-semibold">{mediaFile.name}</p>
                        </>
                      ) : (
                        <>
                          <Upload size={26} className="mx-auto text-slate-300" />
                          <p className="text-xs text-slate-400 mt-2">Tap to upload MP3/MP4</p>
                        </>
                      )}
                    </div>
                  ) : (
                    /* Link input */
                    <input
                      type="url"
                      placeholder="Paste direct media link or YouTube link..."
                      className="w-full px-4 py-3 rounded-xl bg-slate-900/60 border border-slate-600 text-slate-200 placeholder:text-slate-500"
                      value={mediaUrl}
                      onChange={(e) => setMediaUrl(e.target.value)}
                    />
                  )}
                </div>
              )}

              {!isRecorded && (
                <p className="text-[10px] mt-2 text-slate-500">
                  Click to switch to Recording mode.
                </p>
              )}
            </div>

            {/* SUBMIT BUTTON */}
            <button
              type="submit"
              disabled={loading}
              className="w-full py-3 bg-gradient-to-r from-red-600 via-orange-500 to-amber-500
              rounded-2xl text-white font-bold shadow-lg hover:scale-[1.02] transition flex justify-center gap-2"
            >
              {loading ? (
                <>
                  <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                  Publishing...
                </>
              ) : isLive ? (
                <>
                  <RadioReceiver size={16} /> Start Live Broadcast
                </>
              ) : (
                <>
                  <Upload size={16} /> Publish Recording
                </>
              )}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

/**************************************
 *  NEXT â†’ PART 4 (MAIN APP + RENDER)
 **************************************/
/**************************************
 *  MAIN APP
 **************************************/
const App = () => {
  const [user, setUser] = useState(null);
  const [posts, setPosts] = useState([]);

  const [showCreate, setShowCreate] = useState(false);
  const [showProfile, setShowProfile] = useState(false);

  const [currentTrack, setCurrentTrack] = useState(null);
  const [playing, setPlaying] = useState(false);

  /**************************************
   * AUTH LISTENER
   **************************************/
  useEffect(() => {
    const unsub = onAuthStateChanged(auth, (usr) => {
      setUser(usr || null);
    });
    return () => unsub();
  }, []);

  /**************************************
   * POSTS LISTENER
   **************************************/
  useEffect(() => {
    const q = query(collection(db, "bmu_radio_posts"));
    const unsub = onSnapshot(q, (snapshot) => {
      const arr = snapshot.docs.map((d) => ({ id: d.id, ...d.data() }));
      arr.sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
      setPosts(arr);
    });
    return () => unsub();
  }, []);

  /**************************************
   * PLAY HANDLER
   **************************************/
  const handlePlay = (post) => {
    // LIVE STREAM â†’ open link
    if (post.broadcastType === "live") {
      window.open(post.mediaUrl, "_blank");
      return;
    }

    // RECORDINGS â†’ open in player
    setCurrentTrack({
      title: post.title,
      artist: post.authorName || "Unknown",
      url: post.mediaUrl
    });
    setPlaying(true);
  };

  /**************************************
   * LOADING STATE
   **************************************/
  if (user === null) return <LoadingScreen />;

  /**************************************
   * UNAUTH â†’ SHOW LOGIN
   **************************************/
  if (!user) return <LoginSelection setUser={setUser} />;

  /**************************************
   *  MAIN AUTHENTICATED UI
   **************************************/
  return (
    <div className="min-h-screen bg-slate-900 pb-24">
      
      {/* HEADER NAVBAR */}
      <HeaderBar 
        user={user}
        setShowCreate={setShowCreate}
        setShowProfile={setShowProfile}
      />

      {/* FEED */}
      <Feed posts={posts} onPlay={handlePlay} />

      {/* PLAYER */}
      <AudioPlayer 
        currentTrack={currentTrack}
        playing={playing}
        setPlaying={setPlaying}
      />

      {/* CREATE MODAL */}
      {showCreate && (
        <CreatePostModal 
          onClose={() => setShowCreate(false)} 
          user={user} 
        />
      )}

      {/* PROFILE PANEL */}
      {showProfile && (
        <ProfilePanel
          user={user}
          onClose={() => setShowProfile(false)}
        />
      )}
    </div>
  );
};

/**************************************
 *  RENDER REACT APP
 **************************************/
const root = createRoot(document.getElementById("root"));
root.render(<App />);
